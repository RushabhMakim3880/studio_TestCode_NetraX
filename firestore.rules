rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }

    // Rules for chat messages
    match /messages/{messageId} {
      allow read, write: if request.auth != null && (request.auth.token.username == resource.data.sender.username || request.auth.token.username == resource.data.receiver.username);
    }

    // Rules for hosted phishing pages
    match /hostedPages/{pageId} {
      // Anyone can read a page, which is necessary for the API route to serve it.
      allow get;
      // Only authenticated users can create new pages.
      allow create: if request.auth != null;
      // Disallow updates and deletes from the client for security.
      allow update, delete: if false;
    }
  }
}
